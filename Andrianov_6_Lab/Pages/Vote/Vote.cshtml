@page "{id}"
@model VoteModel
@{
    ViewData["Title"] = "Vote";
}

@if (Model.Session == null)
{
    <div class="alert alert-danger">Voting session not found or not available.</div>
}
else
{
    <div class="container">
        <h1>@Model.Session.Title</h1>
        @if (!string.IsNullOrEmpty(Model.Session.Description))
        {
            <p>@Model.Session.Description</p>
        }

        <div class="row">
            <div class="col-md-8">
                <form method="post">
                    <div asp-validation-summary="All" class="text-danger"></div>
                    <h3>Select your choice(s)</h3>
                    @if (Model.Session.Settings?.MultiSelect == true)
                    {
                        <p>You can select up to @Model.Session.Settings.MaxChoices candidates.</p>
                        @for (int i = 0; i < Model.Session.Candidates.Count; i++)
                        {
                            var candidate = Model.Session.Candidates[i];
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="SelectedCandidates" value="@candidate.Id" id="candidate_@i">
                                <label class="form-check-label" for="candidate_@i">
                                    <strong>@candidate.FullName</strong>
                                    @if (!string.IsNullOrEmpty(candidate.Description))
                                    {
                                        <br><small>@candidate.Description</small>
                                    }
                                </label>
                            </div>
                        }
                    }
                    else
                    {
                        <p>Select one candidate.</p>
                        @for (int i = 0; i < Model.Session.Candidates.Count; i++)
                        {
                            var candidate = Model.Session.Candidates[i];
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="SelectedCandidate" value="@candidate.Id" id="candidate_@i">
                                <label class="form-check-label" for="candidate_@i">
                                    <strong>@candidate.FullName</strong>
                                    @if (!string.IsNullOrEmpty(candidate.Description))
                                    {
                                        <br><small>@candidate.Description</small>
                                    }
                                </label>
                            </div>
                        }
                    }

                    <div class="mt-3">
                        <button type="submit" class="btn btn-success">Submit Vote</button>
                        <a href="/" class="btn btn-secondary">Back to Sessions</a>
                    </div>
                </form>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">Session Info</div>
                    <div class="card-body">
                        <p><strong>Start:</strong> @Model.Session.StartAt.ToString("g")</p>
                        <p><strong>End:</strong> @Model.Session.EndAt.ToString("g")</p>
                        <p><strong>Anonymous:</strong> @(Model.Session.Settings?.Anonymous == true ? "Yes" : "No")</p>
                        <p><strong>Multi-select:</strong> @(Model.Session.Settings?.MultiSelect == true ? "Yes" : "No")</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
}